---
title: 'Migrating from V1 to B2B API'
description: 'Complete guide to migrate from Rise V1 API to the new B2B API'
---

# Migrating from V1 to B2B API

Welcome to the Rise B2B API! This guide will help you migrate from the V1 API to our new, more powerful B2B API. The B2B API introduces significant improvements in security, functionality, and developer experience.

<CardGroup cols={2}>
  <Card title="🔐 Enhanced Security" icon="shield">
    SIWE authentication replaces X-Auth-Token for better security
  </Card>
  <Card title="⚡ Better Performance" icon="zap">
    Optimized endpoints with improved response times
  </Card>
  <Card title="🌐 Web3 Native" icon="globe">
    Built for blockchain with EIP-712 typed data signing
  </Card>
  <Card title="📊 Improved Data" icon="bar-chart">
    Enhanced response formats with better error handling
  </Card>
</CardGroup>

## Key Changes Overview

### Authentication Changes
- **V1**: Used SIWE authentication with `/v1/api/siwe` endpoints
- **B2B**: Uses **Sign-In with Ethereum (SIWE)** with `/v2/auth/siwe` endpoints
- **JWT Tokens**: Still used but obtained through updated SIWE flow

### Endpoint Structure
- **V1**: Used `/v1/` prefix with various endpoint patterns
- **B2B**: Uses `/v2/` prefix with consistent REST patterns
- **Base URL**: Updated to `https://api.rise.works` (production)

### Data Formats
- **V1**: Mixed response formats and error structures
- **B2B**: Consistent `{ success: boolean, data: any }` response format
- **Error Handling**: Standardized HTTP status codes with detailed error messages

## Endpoint Migration Table

### Authentication Endpoints

| V1 Endpoint | B2B Endpoint | Changes | Migration Notes |
|-------------|--------------|---------|-----------------|
| `GET /v1/api/siwe` | `GET /v2/auth/siwe` | **Minor** | Updated path structure |
| `POST /v1/api/siwe` | `POST /v2/auth/verify` | **Minor** | Updated path and endpoint name |

### Team Management

| V1 Endpoint | B2B Endpoint | Changes | Migration Notes |
|-------------|--------------|---------|-----------------|
| `GET /v1/teams` | `GET /v2/user/teams` | **Moved** | Now under user endpoints |
| `GET /v1/teams/{teamId}/talent` | `GET /v2/teams/{team_nanoid}/users` | **Major** | Uses nanoid instead of numeric ID |
| `GET /v1/teams/{teamId}/talent/{talentId}` | `GET /v2/teams/{team_nanoid}/member/{user_nanoid}/summary` | **Major** | Uses nanoids, updated endpoint structure |
| `DELETE /v1/teams/{teamId}/talent/{talentId}` | `DELETE /v2/teams/{team_nanoid}/member/{user_nanoid}` | **Major** | Uses nanoids, updated endpoint structure |

### Payment Processing

| V1 Endpoint | B2B Endpoint | Changes | Migration Notes |
|-------------|--------------|---------|-----------------|
| `POST /v1/payments/pay` | `POST /v2/payments` + `PUT /v2/payments` | **Major** | Split into create and execute steps |
| `PUT /v1/payments/pay` | `POST /v2/payments` + `PUT /v2/payments` | **Major** | Split into create and execute steps |
| `POST /v1/payments/batch-pay` | `POST /v2/payments` + `PUT /v2/payments` | **Major** | Unified endpoint for single and batch payments |
| `PUT /v1/payments/batch-pay` | `POST /v2/payments` + `PUT /v2/payments` | **Major** | Unified endpoint for single and batch payments |
| `POST /v1/payments/batch-pay/intents` | `POST /v2/payments` + `PUT /v2/payments` | **Major** | Use `pay_now: false` flag for intents |
| `GET /v1/payments/` | `GET /v2/payments` | **Major** | Updated query parameters and response format |

### Balance Management

| V1 Endpoint | B2B Endpoint | Changes | Migration Notes |
|-------------|--------------|---------|-----------------|
| `GET /v1/riseid/{rise_id}/balance` | `GET /v2/balance?nanoid={nanoid}` | **Major** | Uses nanoid instead of rise_id, updated response format |

### Invites Management

| V1 Endpoint | B2B Endpoint | Changes | Migration Notes |
|-------------|--------------|---------|-----------------|
| `GET /v1/invites/` | `GET /v2/invites` | **Minor** | Updated path structure |
| `POST /v1/invites/` | `POST /v2/invites` | **Minor** | Updated path structure |
| `POST /v1/invites/manager` | `POST /v2/invites/manager` | **Minor** | Updated path structure |
| `POST /v1/invites/warmed` | `POST /v2/invites` | **Minor** | Unified endpoint for all invite types |

## New B2B API Endpoints (Not in V1)

The B2B API introduces several new endpoints that weren't available in V1:

### Team Management (Enhanced)
- `GET /v2/teams/{team_nanoid}/settings` - Get team settings
- `PUT /v2/teams/{team_nanoid}/settings` - Update team settings
- `GET /v2/teams/{team_nanoid}` - Get team by nanoid
- `DELETE /v2/teams/{team_nanoid}` - Delete team by nanoid
- `PUT /v2/teams/{team_nanoid}` - Update team by nanoid
- `POST /v2/teams` - Create a team
- `GET /v2/teams/{team_nanoid}/member/{user_nanoid}/settings` - Get member settings
- `PUT /v2/teams/{team_nanoid}/member/{user_nanoid}/settings` - Update member settings

### Company Management
- `GET /v2/company/{nanoid}/users` - Get company users
- `PUT /v2/company/{nanoid}/address` - Update company address
- `GET /v2/company/{nanoid}/details` - Get company details
- `PUT /v2/company/{nanoid}/details` - Update company details
- `GET /v2/company/{nanoid}/members/{user_nanoid}/settings` - Get member settings
- `GET /v2/company/{nanoid}/settings` - Get company settings
- `PUT /v2/company/{nanoid}/settings` - Update company settings
- `GET /v2/company/{nanoid}/contacts` - Get company contacts
- `GET /v2/company/{nanoid}/ownership` - Get company ownership

### User Management
- `GET /v2/user/organizations` - Get user organizations
- `PUT /v2/user/address` - Update user address
- `POST /v2/user/avatar/update` - Update user avatar

### Payroll Management
- `GET /v2/payroll/team/{team_nanoid}` - Get team payroll
- `POST /v2/payroll/team/{team_nanoid}` - Create team payroll
- `GET /v2/payroll/team/{team_nanoid}/period` - Get payroll periods

### Withdrawal Management
- `POST /v2/withdraw/{account_nanoid}` - Create withdrawal
- `PUT /v2/withdraw/{account_nanoid}` - Execute withdrawal
- `GET /v2/withdraw/{account_nanoid}/fee` - Get withdrawal fee

### Webhook Management
- `POST /webhooks/register` - Register webhook
- `GET /webhooks` - List webhooks
- `GET /webhooks/{webhook_nanoid}` - Get webhook
- `PUT /webhooks/{webhook_nanoid}` - Update webhook
- `DELETE /webhooks/{webhook_nanoid}` - Delete webhook

### User Profile
- `GET /v2/me` - Get current user profile

## Authentication Migration

### V1 Authentication (Old)
```javascript
// V1: SIWE authentication
const siweResponse = await fetch('https://api.rise.works/v1/api/siwe', {
  method: 'GET',
  headers: { 'Content-Type': 'application/json' }
});

const { siwe } = await siweResponse.json();

// Sign with wallet
const provider = new ethers.BrowserProvider(window.ethereum);
const signer = await provider.getSigner();
const signature = await signer.signMessage(siwe);

// Verify and get JWT
const verifyResponse = await fetch('https://api.rise.works/v1/api/siwe', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ message: siwe, signature: signature })
});

const { token } = await verifyResponse.json();
```

### B2B Authentication (New)
```javascript
// B2B: SIWE authentication flow
class RiseAuth {
  async authenticate(walletAddress, riseId) {
    // Step 1: Get SIWE message
    const siweResponse = await fetch(
      `https://api.rise.works/v2/auth/siwe?wallet=${walletAddress}&riseid=${riseId}`
    );
    const { siwe } = siweResponse.data.data;

    // Step 2: Sign with wallet
    const provider = new ethers.BrowserProvider(window.ethereum);
    const signer = await provider.getSigner();
    const signature = await signer.signMessage(siwe);

    // Extract nonce from SIWE message
    const nonceMatch = siwe.match(/Nonce: (.+)/);
    const nonce = nonceMatch ? nonceMatch[1] : '';

    // Step 3: Verify and get JWT
    const verifyResponse = await fetch('https://api.rise.works/v2/auth/verify', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: siwe, sig: signature, nonce })
    });

    const { jwt } = verifyResponse.data.data;
    return jwt;
  }
}

// Use JWT in requests (same as V1)
const apiResponse = await fetch('https://api.rise.works/v2/teams', {
  headers: { 'Authorization': `Bearer ${jwt}` }
});
```

## Data Format Changes

### Response Format

**V1 Response:**
```json
{
  "teams": [
    {
      "id": 123,
      "name": "Engineering Team",
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**B2B Response:**
```json
{
  "success": true,
  "data": {
    "teams": [
      {
        "nanoid": "te-abc123def456",
        "name": "Engineering Team",
        "created_at": "2024-01-01T00:00:00Z"
      }
    ]
  }
}
```

### Error Format

**V1 Error:**
```json
{
  "error": "Team not found",
  "error_code": "TEAM_NOT_FOUND"
}
```

**B2B Error:**
```json
{
  "success": false,
  "data": "Team te-abc123def456 not found"
}
```

## ID System Changes

### V1: Mixed ID System
- Teams: `123`, `456`, `789` (numeric IDs)
- Users: `talentId` (numeric IDs)
- RiseID: `rise_id` (string format)

### B2B: Nanoid System
- Teams: `te-abc123def456`
- Users: `us-ghi789jkl012`
- Companies: `co-def456ghi789`
- Payments: `pa-pay123def456`

## Migration Checklist

### Phase 1: Preparation
- [ ] **Review new authentication flow** - Update SIWE authentication paths
- [ ] **Update base URL** - Change to `https://api.rise.works`
- [ ] **Update endpoint paths** - Change from `/v1/` to `/v2/`
- [ ] **Test authentication** - Verify updated SIWE flow works

### Phase 2: Core Migration
- [ ] **Update team endpoints** - Replace numeric IDs with nanoids
- [ ] **Update user endpoints** - Replace numeric IDs with nanoids
- [ ] **Update balance endpoints** - Use new query parameter format
- [ ] **Update response handling** - Handle new `{ success, data }` format

### Phase 3: Advanced Features
- [ ] **Implement EIP-712 signing** - For payments and team management
- [ ] **Update error handling** - Handle new error format
- [ ] **Test all endpoints** - Verify functionality works as expected
- [ ] **Update documentation** - Update internal API documentation

### Phase 4: Production Deployment
- [ ] **Deploy to staging** - Test with staging environment
- [ ] **Monitor performance** - Ensure no performance regressions
- [ ] **Deploy to production** - Switch to B2B API
- [ ] **Monitor logs** - Watch for any issues

## Code Migration Examples

### Team Member Retrieval

**V1 Code:**
```javascript
const getTeamMembers = async (teamId) => {
  const response = await fetch(`https://api.rise.works/v1/teams/${teamId}/talent`, {
    headers: { 'X-Auth-Token': token }
  });
  
  const members = await response.json();
  return members; // Returns array of members
};
```

**B2B Code:**
```javascript
const getTeamMembers = async (teamNanoid) => {
  const response = await fetch(`https://api.rise.works/v2/teams/${teamNanoid}/users`, {
    headers: { 'Authorization': `Bearer ${jwt}` }
  });
  
  const result = await response.json();
  return result.data.users; // Returns array of users
};
```

### Payment Processing

**V1 Code:**
```javascript
const createPayment = async (teamId, recipients) => {
  // Step 1: Get typed data
  const typedDataResponse = await fetch('https://api.rise.works/v1/payments/pay', {
    method: 'PUT',
    headers: {
      'X-Auth-Token': token,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      team_id: teamId,
      recipients: recipients
    })
  });
  
  const { typed_data } = await typedDataResponse.json();
  
  // Step 2: Sign and execute
  const provider = new ethers.BrowserProvider(window.ethereum);
  const signer = await provider.getSigner();
  const signature = await signer.signTypedData(
    typed_data.domain,
    typed_data.types,
    typed_data.message
  );
  
  const executeResponse = await fetch('https://api.rise.works/v1/payments/pay', {
    method: 'POST',
    headers: {
      'X-Auth-Token': token,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      team_id: teamId,
      recipients: recipients,
      signature: signature
    })
  });
  
  return await executeResponse.json();
};
```

**B2B Code:**
```javascript
const createPayment = async (teamNanoid, recipients, walletAddress) => {
  // Step 1: Create payment draft
  const createResponse = await fetch('https://api.rise.works/v2/payments', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${jwt}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      from: teamNanoid,
      to: recipients,
      pay_now: false,
      network: 'arbitrum'
    })
  });
  
  const { typed_data } = createResponse.data.data;
  
  // Step 2: Sign typed data
  const provider = new ethers.BrowserProvider(window.ethereum);
  const signer = await provider.getSigner();
  const signature = await signer.signTypedData(
    typed_data.domain,
    typed_data.types,
    typed_data.typed_data
  );
  
  // Step 3: Execute payment
  const executeResponse = await fetch('https://api.rise.works/v2/payments', {
    method: 'PUT',
    headers: {
      'Authorization': `Bearer ${jwt}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      signer: walletAddress,
      from: teamNanoid,
      to: recipients,
      pay_now: false,
      typed_data: typed_data,
      signature: signature
    })
  });
  
  return await executeResponse.json();
};
```

### Balance Retrieval

**V1 Code:**
```javascript
const getBalance = async (riseId) => {
  const response = await fetch(`https://api.rise.works/v1/riseid/${riseId}/balance`, {
    headers: { 'X-Auth-Token': token }
  });
  
  const balance = await response.json();
  return balance; // Returns balance in decimals
};
```

**B2B Code:**
```javascript
const getBalance = async (nanoid) => {
  const response = await fetch(`https://api.rise.works/v2/balance?nanoid=${nanoid}`, {
    headers: { 'Authorization': `Bearer ${jwt}` }
  });
  
  const result = await response.json();
  return result.data; // Returns balance with account address and currency breakdown
};
```

## Common Migration Issues

### Issue 1: Authentication Errors
**Problem:** Getting 401 errors after migration
**Solution:** 
- Update SIWE endpoint paths from `/v1/api/siwe` to `/v2/auth/siwe` and `/v2/auth/verify`
- Check that JWT tokens are included as `Authorization: Bearer <jwt>` headers
- Verify JWT hasn't expired (24-hour lifetime)

### Issue 2: ID Format Errors
**Problem:** Getting 404 errors for resources that should exist
**Solution:**
- Replace numeric IDs with nanoids
- Update all endpoint URLs to use nanoid format
- Check that you're using the correct nanoid type (team, user, company)

### Issue 3: Response Format Errors
**Problem:** Code expecting old response format
**Solution:**
- Update response handling to use `response.data.data` instead of direct properties
- Handle the new `{ success, data }` wrapper format
- Update error handling to use `response.data` for error messages

### Issue 4: Missing EIP-712 Signing
**Problem:** Getting errors about missing signatures
**Solution:**
- Implement EIP-712 typed data signing for operations that require it
- Use the two-step process (create + execute) for payments and team management
- Ensure wallet is connected and has proper permissions

## Testing Your Migration

### 1. Authentication Test
```javascript
// Test updated SIWE authentication
const jwt = await riseAuth.authenticate(walletAddress, riseId);
console.log('Authentication successful:', !!jwt);
```

### 2. Basic API Test
```javascript
// Test basic API calls
const teams = await fetch('https://api.rise.works/v2/user/teams', {
  headers: { 'Authorization': `Bearer ${jwt}` }
});
console.log('Teams API working:', teams.ok);
```

### 3. Payment Test
```javascript
// Test payment creation (without execution)
const paymentDraft = await createPaymentDraft(teamNanoid, recipients);
console.log('Payment draft created:', !!paymentDraft.typed_data);
```

## Support During Migration

<CardGroup cols={2}>
  <Card title="Documentation" icon="book" href="/authentication">
    Complete B2B API documentation
  </Card>
  <Card title="API Reference" icon="code" href="/api-reference">
    Interactive API reference
  </Card>
  <Card title="Support Email" icon="mail" href="mailto:Hello@Riseworks.io">
    Get migration assistance
  </Card>
  <Card title="Status Page" icon="activity" href="https://status.rise.works">
    Check API status
  </Card>
</CardGroup>

## Migration Timeline

### Recommended Timeline
- **Week 1-2**: Set up updated SIWE authentication and test basic endpoints
- **Week 3-4**: Migrate core functionality (teams, users, balances)
- **Week 5-6**: Implement EIP-712 signing for payments and advanced features
- **Week 7-8**: Testing and production deployment

### Rollback Plan
- Keep V1 API access during migration period
- Implement feature flags to switch between V1 and B2B
- Monitor error rates and performance metrics
- Have rollback procedures ready if issues arise

<Note>
  **Need Help?** Our support team is available to help with your migration. Contact us at Hello@Riseworks.io for personalized assistance.
</Note>

<Warning>
  **Important**: The V1 API will be deprecated in the future. We recommend completing your migration as soon as possible to ensure continued access to Rise services.
</Warning> 