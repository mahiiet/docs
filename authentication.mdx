---
title: 'Authentication'
description: 'Learn how to authenticate with Rise using Sign-In with Ethereum (SIWE)'
---

# Authentication

Rise uses **Sign-In with Ethereum (SIWE)** for secure, blockchain-based authentication. This ensures that only users with the correct wallet permissions can access the API.

## Overview

The authentication flow consists of two main steps:

1. **Get SIWE Message**: Request a message to sign from the user's wallet.
2. **Verify Signature**: Submit the signed message, signature, and nonce to obtain a JWT token.

## Authentication Flow

<Steps>
  <Step title="Request SIWE Message">
    Call the `/v2/auth/siwe` endpoint with the user's wallet address and RiseID to get a message to sign.
  </Step>
  <Step title="User Signs Message">
    The user signs the SIWE message using their wallet (MetaMask, WalletConnect, etc.).
  </Step>
  <Step title="Verify Signature">
    Submit the signed message, signature, and nonce to `/v2/auth/verify` to obtain a JWT token.
  </Step>
  <Step title="Use JWT Token">
    Include the JWT token in the Authorization header for subsequent API calls.
  </Step>
</Steps>

## Step 1: Get SIWE Message

Request a SIWE message for the user to sign:

```bash
curl -X GET "https://api.rise.works/v2/auth/siwe?wallet=0x1234...&riseid=rise_123456789"
```

**Response:**
```json
{
  "success": true,
  "data": {
    "siwe": "rise.works wants you to sign in with your Ethereum account:\n0x1234567890abcdef...\n...Nonce: abc123def456..."
  }
}
```

## Step 2: User Signs Message

The user signs the SIWE message using their wallet.  
**You must extract the nonce from the SIWE message** (look for the `Nonce:` line).

**Important**: The nonce is automatically generated by the server and included in the SIWE message. You need to extract this nonce to use in Step 3.

**Example (JavaScript/ethers):**
```js
// Extract nonce from the SIWE message
const nonceMatch = siweMessage.match(/Nonce: (.+)/);
const nonce = nonceMatch ? nonceMatch[1] : '';

// Sign the message with the user's wallet
const provider = new ethers.BrowserProvider(window.ethereum);
const signer = await provider.getSigner();
const signature = await signer.signMessage(siweMessage);
```

## Step 3: Verify Signature

Submit the signed message, signature, and nonce to obtain a JWT:

```bash
curl -X POST "https://api.rise.works/v2/auth/verify" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "<the SIWE message>",
    "sig": "<the signature>",
    "nonce": "<the nonce from SIWE message>"
  }'
```

**Response:**
```json
{
  "success": true,
  "data": {
    "jwt": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

## Step 4: Use JWT Token

Include the JWT in the `Authorization` header for all subsequent API calls:

```http
Authorization: Bearer <jwt>
```

## Notes & Best Practices

- **Nonce**: Always extract and use the nonce from the SIWE message.
- **JWT Expiry**: JWT tokens expire after 24 hours.
- **Security**: Never store private keys or signatures in client-side code. Always use wallet providers for signing.
- **Error Handling**: Handle errors such as invalid wallet, invalid signature, expired nonce, or unauthorized access.

## Code Examples

The following code samples show how to implement the authentication flow in different languages and frameworks.

## Complete Authentication Example

Here's a complete example of the authentication flow:

<CodeGroup>

```javascript
import { ethers } from 'ethers';

class RiseAuth {
  constructor(baseUrl = 'https://api.rise.works') {
    this.baseUrl = baseUrl;
  }

  async authenticate(walletAddress, riseId) {
    try {
      // Step 1: Get SIWE message
      const siweResponse = await fetch(
        `${this.baseUrl}/v2/auth/siwe?wallet=${walletAddress}&riseid=${riseId}`
      );
      const { data: { siwe } } = await siweResponse.json();

      // Step 2: Sign the message
      const provider = new ethers.BrowserProvider(window.ethereum);
      const signer = await provider.getSigner();
      const signature = await signer.signMessage(siwe);

      // Extract nonce from the message
      const nonceMatch = siwe.match(/Nonce: (.+)/);
      const nonce = nonceMatch ? nonceMatch[1] : '';

      // Step 3: Verify signature and get JWT
      const verifyResponse = await fetch(`${this.baseUrl}/v2/auth/verify`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: siwe,
          sig: signature,
          nonce: nonce
        })
      });

      const { data: { jwt } } = await verifyResponse.json();
      return jwt;
    } catch (error) {
      console.error('Authentication failed:', error);
      throw error;
    }
  }
}
```

```typescript
import { ethers } from 'ethers';

interface SiweResponse {
  success: boolean;
  data: { siwe: string };
}

interface VerifyResponse {
  success: boolean;
  data: { jwt: string };
}

class RiseAuth {
  private baseUrl: string;

  constructor(baseUrl: string = 'https://api.rise.works') {
    this.baseUrl = baseUrl;
  }

  async authenticate(walletAddress: string, riseId: string): Promise<string> {
    try {
      // Step 1: Get SIWE message
      const siweResponse = await fetch(
        `${this.baseUrl}/v2/auth/siwe?wallet=${walletAddress}&riseid=${riseId}`
      );
      const { data: { siwe } }: SiweResponse = await siweResponse.json();

      // Step 2: Sign the message
      const provider = new ethers.BrowserProvider(window.ethereum);
      const signer = await provider.getSigner();
      const signature = await signer.signMessage(siwe);

      // Extract nonce from the message
      const nonceMatch = siwe.match(/Nonce: (.+)/);
      const nonce = nonceMatch ? nonceMatch[1] : '';

      // Step 3: Verify signature and get JWT
      const verifyResponse = await fetch(`${this.baseUrl}/v2/auth/verify`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: siwe,
          sig: signature,
          nonce: nonce
        })
      });

      const { data: { jwt } }: VerifyResponse = await verifyResponse.json();
      return jwt;
    } catch (error) {
      console.error('Authentication failed:', error);
      throw error;
    }
  }
}
```

</CodeGroup>

## Error Handling

Common authentication errors and how to handle them:

<ResponseExample>
```json
{
  "success": false,
  "data": "Wallet address is required"
}
```
</ResponseExample>

| HTTP Status Code | Description | Solution |
|------------------|-------------|----------|
| `400` | Bad Request - Missing or invalid parameters | Check that wallet address and RiseID are provided and valid |
| `401` | Unauthorized - Invalid signature or expired nonce | Re-authenticate with a new SIWE message |
| `403` | Forbidden - User lacks permission for the RiseID | Verify the wallet has proper permissions for the specified RiseID |
| `404` | Not Found - RiseID doesn't exist | Verify the RiseID exists in the system |
| `500` | Internal Server Error | Retry the request or contact support |

### Common Error Scenarios

**Invalid Wallet Address (400):**
```json
{
  "success": false,
  "data": "Wallet address is required"
}
```

**Invalid RiseID (404):**
```json
{
  "success": false,
  "data": "No entity found with riseid rise_invalid"
}
```

**Permission Denied (403):**
```json
{
  "success": false,
  "data": "Invalid Rise account 0x1234..."
}
```

**SIWE Verification Failed (401):**
```json
{
  "success": false,
  "data": "SIWE error: Invalid signature"
}
```

## Security Considerations

<Warning>
  **Never store private keys or signatures in client-side code.** Always use wallet providers like MetaMask or WalletConnect for signing.
</Warning>

- **Token Expiration**: JWT tokens expire after 24 hours - implement automatic refresh logic
- **Nonce Validation**: Each SIWE message has a unique nonce to prevent replay attacks - never reuse nonces
- **Chain ID for SIWE**: SIWE authentication uses Ethereum mainnet (Chain ID 1) for production and Goerli testnet (Chain ID 5) for development
- **Rise Operations**: While SIWE uses Ethereum, Rise's payment and smart contract operations are on Arbitrum mainnet (Chain ID 42161)
- **Domain Verification**: The SIWE message includes the domain to prevent phishing attacks - always verify the domain
- **Signature Verification**: All signatures are verified on-chain to ensure authenticity

## Environment-Specific Configuration

<CodeGroup>

```javascript
// Development (Goerli testnet for SIWE, Arbitrum Sepolia for operations)
const DEV_CONFIG = {
  baseUrl: 'https://dev-pay-api.riseworks.dev',
  siweChainId: 5,        // Goerli testnet for SIWE authentication
  riseChainId: 421614    // Arbitrum Sepolia for Rise operations
};

// Staging
const STAGING_CONFIG = {
  baseUrl: 'https://staging-pay-api.riseworks.io',
  siweChainId: 5,        // Goerli testnet for SIWE authentication
  riseChainId: 421614    // Arbitrum Sepolia for Rise operations
};

// Production (Ethereum mainnet for SIWE, Arbitrum mainnet for operations)
const PROD_CONFIG = {
  baseUrl: 'https://pay-api.riseworks.io',
  siweChainId: 1,        // Ethereum mainnet for SIWE authentication
  riseChainId: 42161     // Arbitrum mainnet for Rise operations
};
```

```typescript
interface RiseConfig {
  baseUrl: string;
  siweChainId: number;   // Chain ID for SIWE authentication
  riseChainId: number;   // Chain ID for Rise operations
}

const DEV_CONFIG: RiseConfig = {
  baseUrl: 'https://dev-pay-api.riseworks.dev',
  siweChainId: 5,        // Goerli testnet for SIWE authentication
  riseChainId: 421614    // Arbitrum Sepolia for Rise operations
};

const STAGING_CONFIG: RiseConfig = {
  baseUrl: 'https://staging-pay-api.riseworks.io',
  siweChainId: 5,        // Goerli testnet for SIWE authentication
  riseChainId: 421614    // Arbitrum Sepolia for Rise operations
};

const PROD_CONFIG: RiseConfig = {
  baseUrl: 'https://pay-api.riseworks.io',
  siweChainId: 1,        // Ethereum mainnet for SIWE authentication
  riseChainId: 42161     // Arbitrum mainnet for Rise operations
};
```

</CodeGroup>

## Real-World Integration Examples

### React Hook for Authentication

```typescript
import { useState, useEffect } from 'react';
import { ethers } from 'ethers';

interface UseRiseAuth {
  jwt: string | null;
  loading: boolean;
  error: string | null;
  authenticate: (walletAddress: string, riseId: string) => Promise<void>;
  logout: () => void;
}

export function useRiseAuth(): UseRiseAuth {
  const [jwt, setJwt] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const authenticate = async (walletAddress: string, riseId: string) => {
    setLoading(true);
    setError(null);
    
    try {
      const auth = new RiseAuth();
      const token = await auth.authenticate(walletAddress, riseId);
      setJwt(token);
      localStorage.setItem('rise_jwt', token);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Authentication failed');
    } finally {
      setLoading(false);
    }
  };

  const logout = () => {
    setJwt(null);
    localStorage.removeItem('rise_jwt');
  };

  useEffect(() => {
    const storedJwt = localStorage.getItem('rise_jwt');
    if (storedJwt) {
      setJwt(storedJwt);
    }
  }, []);

  return { jwt, loading, error, authenticate, logout };
}
```

### Next.js API Route for Server-Side Auth

```typescript
// pages/api/auth/verify.ts
import type { NextApiRequest, NextApiResponse } from 'next';

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== 'POST') {
    return res.status(405).json({ message: 'Method not allowed' });
  }

  try {
    const { message, sig, nonce } = req.body;

    const response = await fetch('https://api.rise.works/v2/auth/verify', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message, sig, nonce })
    });

    const data = await response.json();
    res.status(response.status).json(data);
  } catch (error) {
    res.status(500).json({ message: 'Internal server error' });
  }
}